---
---

<!-- Cart Modal -->
<div id="cart-modal" class="fixed inset-0 bg-black/50 z-50 hidden">
  <div class="flex items-center justify-center min-h-screen p-4">
    <div class="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden">
      <!-- Header -->
      <div class="flex justify-between items-center p-6 border-b border-sage-200">
        <h2 class="font-serif text-2xl font-semibold text-earth-800">Tu Carrito</h2>
        <button id="close-cart" class="p-2 rounded-full hover:bg-sage-100 transition-colors">
          <svg class="w-6 h-6 text-earth-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>

      <!-- Cart Content -->
      <div class="p-6 max-h-96 overflow-y-auto">
        <div id="cart-items" class="space-y-4">
          <!-- Cart items will be dynamically added here -->
        </div>
        
        <div id="empty-cart" class="text-center py-8 hidden">
          <svg class="w-16 h-16 text-sage-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l-1 12H6L5 9z"></path>
          </svg>
          <p class="text-earth-600 text-lg">Tu carrito está vacío</p>
          <p class="text-earth-500 text-sm">¡Explora nuestros productos y encuentra lo que necesitas!</p>
        </div>
      </div>

      <!-- Footer -->
      <div class="border-t border-sage-200 p-6">
        <div class="flex justify-between items-center mb-4">
          <span class="font-serif text-xl font-semibold text-earth-800">Total:</span>
          <span id="cart-total" class="font-bold text-2xl text-earth-800">$0</span>
        </div>
        
        <div class="space-y-3">
          <button 
            id="whatsapp-checkout" 
            class="w-full bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-semibold transition-all duration-300 hover:scale-105 flex items-center justify-center"
          >
            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24">
              <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"/>
            </svg>
            Comprar por WhatsApp
          </button>
          
          <a 
            href="/carrito"
            class="block w-full text-center border border-sage-300 text-sage-600 hover:bg-sage-50 px-6 py-3 rounded-lg font-medium transition-colors"
          >
            Ver Carrito Completo
          </a>
          
          <button 
            id="clear-cart" 
            class="w-full border border-red-300 text-red-600 hover:bg-red-50 px-6 py-3 rounded-lg font-medium transition-colors"
          >
            Limpiar Carrito
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // Cart functionality
  document.addEventListener('DOMContentLoaded', function() {
    const cartModal = document.getElementById('cart-modal');
    const cartBtn = document.getElementById('cart-btn');
    const closeCartBtn = document.getElementById('close-cart');
    const cartItems = document.getElementById('cart-items');
    const emptyCart = document.getElementById('empty-cart');
    const cartTotal = document.getElementById('cart-total');
    const whatsappCheckout = document.getElementById('whatsapp-checkout');
    const clearCartBtn = document.getElementById('clear-cart');

    // Open cart modal
    cartBtn?.addEventListener('click', () => {
      cartModal?.classList.remove('hidden');
      renderCart();
    });

    // Close cart modal
    closeCartBtn?.addEventListener('click', () => {
      cartModal?.classList.add('hidden');
    });

    // Close modal when clicking outside
    cartModal?.addEventListener('click', (e) => {
      if (e.target === cartModal) {
        cartModal.classList.add('hidden');
      }
    });

    // Render cart items
    function renderCart() {
      const cart = JSON.parse(localStorage.getItem('cart')) || [];
      
      if (cart.length === 0) {
        cartItems.innerHTML = '';
        emptyCart.classList.remove('hidden');
        cartTotal.textContent = '$0';
        return;
      }

      emptyCart.classList.add('hidden');
      
      let total = 0;
      cartItems.innerHTML = cart.map(item => {
        const itemTotal = item.price * item.quantity;
        total += itemTotal;
        
        return `
          <div class="flex items-center justify-between p-4 bg-sage-50 rounded-lg">
            <div class="flex-1">
              <h3 class="font-semibold text-earth-800">${item.name}</h3>
              <p class="text-sm text-earth-600">$${item.price.toLocaleString()} c/u</p>
            </div>
            <div class="flex items-center space-x-3">
              <button class="decrease-qty bg-sage-200 hover:bg-sage-300 w-8 h-8 rounded-full flex items-center justify-center transition-colors" data-id="${item.id}">
                <svg class="w-4 h-4 text-earth-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"></path>
                </svg>
              </button>
              <span class="font-semibold text-earth-800 w-8 text-center">${item.quantity}</span>
              <button class="increase-qty bg-sage-200 hover:bg-sage-300 w-8 h-8 rounded-full flex items-center justify-center transition-colors" data-id="${item.id}">
                <svg class="w-4 h-4 text-earth-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v12m6-6H6"></path>
                </svg>
              </button>
            </div>
            <div class="ml-4 text-right">
              <p class="font-semibold text-earth-800">$${itemTotal.toLocaleString()}</p>
              <button class="remove-item text-red-500 hover:text-red-700 text-sm transition-colors" data-id="${item.id}">
                Eliminar
              </button>
            </div>
          </div>
        `;
      }).join('');

      cartTotal.textContent = `$${total.toLocaleString()}`;

      // Add event listeners to quantity buttons
      document.querySelectorAll('.increase-qty').forEach(btn => {
        btn.addEventListener('click', () => {
          updateQuantity(btn.dataset.id, 1);
        });
      });

      document.querySelectorAll('.decrease-qty').forEach(btn => {
        btn.addEventListener('click', () => {
          updateQuantity(btn.dataset.id, -1);
        });
      });

      document.querySelectorAll('.remove-item').forEach(btn => {
        btn.addEventListener('click', () => {
          removeItem(btn.dataset.id);
        });
      });
    }

    // Update quantity
    function updateQuantity(id, change) {
      let cart = JSON.parse(localStorage.getItem('cart')) || [];
      const item = cart.find(item => item.id === id);
      
      if (item) {
        item.quantity += change;
        if (item.quantity <= 0) {
          cart = cart.filter(item => item.id !== id);
        }
      }
      
      localStorage.setItem('cart', JSON.stringify(cart));
      updateCartCount();
      renderCart();
    }

    // Remove item
    function removeItem(id) {
      let cart = JSON.parse(localStorage.getItem('cart')) || [];
      cart = cart.filter(item => item.id !== id);
      localStorage.setItem('cart', JSON.stringify(cart));
      updateCartCount();
      renderCart();
    }

    // WhatsApp checkout
    whatsappCheckout?.addEventListener('click', () => {
      const cart = JSON.parse(localStorage.getItem('cart')) || [];
      
      if (cart.length === 0) {
        alert('Tu carrito está vacío');
        return;
      }

      let message = 'Hola, me gustaría realizar una compra:\n\n';
      let total = 0;
      
      cart.forEach(item => {
        const itemTotal = item.price * item.quantity;
        total += itemTotal;
        message += `• ${item.quantity}x ${item.name} - $${itemTotal.toLocaleString()}\n`;
      });
      
      message += `\nTotal: $${total.toLocaleString()}\n\nPor favor, ayúdame a finalizar mi pedido. ¡Gracias!`;
      
      const whatsappUrl = `https://wa.me/573001234567?text=${encodeURIComponent(message)}`;
      window.open(whatsappUrl, '_blank');
    });

    // Clear cart
    clearCartBtn?.addEventListener('click', () => {
      if (confirm('¿Estás seguro de que quieres limpiar tu carrito?')) {
        localStorage.removeItem('cart');
        updateCartCount();
        renderCart();
      }
    });

    // Initialize cart count
    function updateCartCount() {
      const cart = JSON.parse(localStorage.getItem('cart')) || [];
      const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
      const cartCountElements = document.querySelectorAll('#cart-count, #mobile-cart-count');
      cartCountElements.forEach(el => {
        if (el) el.textContent = totalItems.toString();
      });
    }

    // Make renderCart available globally
    window.renderCart = renderCart;

    updateCartCount();
  });
</script>