---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import Cart from '../components/Cart.astro';
import { products } from '../data/products.js';
---

<Layout title="Tienda - Be Nice Fungi Shop" description="Explora nuestra colección premium de hongos funcionales. Microdosis, extractos, cápsulas y mezclas especiales para tu bienestar natural.">
  <Header />
  
  <main class="pt-20">
    <!-- Hero Section -->
    <section class="py-16 bg-gradient-to-br from-cream-50 to-sage-50 relative overflow-hidden">
      <div class="absolute inset-0 opacity-10">
        <div class="ornamental-pattern w-full h-full"></div>
      </div>
      
      <div class="container mx-auto px-4 relative z-10">
        <div class="text-center max-w-4xl mx-auto">
          <h1 class="font-display text-5xl md:text-6xl font-bold text-earth-800 mb-6">
            Nuestra Tienda
          </h1>
          <p class="text-xl md:text-2xl text-earth-600 mb-8 leading-relaxed">
            Descubre nuestra cuidadosa selección de hongos funcionales premium, 
            cada uno elegido por sus propiedades únicas y beneficios comprobados para tu bienestar.
          </p>
          <div class="flex justify-center items-center space-x-4">
            <div class="w-16 h-0.5 bg-gradient-to-r from-transparent to-earth-500"></div>
            <div class="w-3 h-3 bg-earth-500 rounded-full"></div>
            <div class="w-2 h-2 bg-sage-500 rounded-full"></div>
            <div class="w-3 h-3 bg-mushroom-500 rounded-full"></div>
            <div class="w-2 h-2 bg-sage-500 rounded-full"></div>
            <div class="w-3 h-3 bg-earth-500 rounded-full"></div>
            <div class="w-16 h-0.5 bg-gradient-to-l from-transparent to-earth-500"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- Filter Section -->
    <section class="py-8 bg-white border-b border-sage-200">
      <div class="container mx-auto px-4">
        <div class="flex flex-wrap justify-center gap-4">
          <button class="filter-btn active bg-sage-500 text-white px-6 py-3 rounded-full font-medium transition-all duration-300 hover:scale-105 shadow-lg" data-filter="all">
            Todos los Productos
          </button>
          <button class="filter-btn bg-sage-100 text-sage-700 hover:bg-sage-200 px-6 py-3 rounded-full font-medium transition-all duration-300 hover:scale-105" data-filter="microdosis">
            Microdosis
          </button>
          <button class="filter-btn bg-sage-100 text-sage-700 hover:bg-sage-200 px-6 py-3 rounded-full font-medium transition-all duration-300 hover:scale-105" data-filter="extractos">
            Extractos
          </button>
          <button class="filter-btn bg-sage-100 text-sage-700 hover:bg-sage-200 px-6 py-3 rounded-full font-medium transition-all duration-300 hover:scale-105" data-filter="capsulas">
            Cápsulas
          </button>
          <button class="filter-btn bg-sage-100 text-sage-700 hover:bg-sage-200 px-6 py-3 rounded-full font-medium transition-all duration-300 hover:scale-105" data-filter="mezclas">
            Mezclas Especiales
          </button>
        </div>
      </div>
    </section>

    <!-- Search Bar -->
    <div class="flex justify-center mb-10 mt-8">
      <input
        id="search-bar"
        type="text"
        placeholder="Buscar por nombre, beneficio o categoría..."
        class="w-full max-w-xl px-6 py-3 rounded-full border-2 border-sage-200 focus:border-sage-500 focus:ring-2 focus:ring-sage-100 text-lg transition-all duration-300 shadow"
      />
    </div>

    <!-- Products Grid -->
    <section class="py-16 bg-cream-50">
      <div class="container mx-auto px-4">
        <div class="grid md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8" id="products-grid">
          {products.map((product) => (
            <div
              class="product-card bg-white rounded-2xl shadow-lg overflow-hidden hover:shadow-xl transition-all duration-300 hover:scale-105 border-2 border-sage-100"
              data-category={product.category}
              data-benefits={product.benefits ? product.benefits.join(',') : ''}
              data-name={product.name.toLowerCase()}
            >
              <div class="relative aspect-square overflow-hidden">
                <img 
                  src={product.images[0]} 
                  alt={product.name}
                  class="w-full h-full object-cover hover:scale-110 transition-transform duration-500"
                />
                {/* Badge visual */}
                {product.badge && (
                  <span class="absolute top-3 left-3 bg-earth-500 text-white text-xs font-bold px-3 py-1 rounded-full shadow-lg z-10 animate-fade-in">
                    {product.badge}
                  </span>
                )}
                {/* Badge de agotado */}
                {!product.inStock && (
                  <div class="absolute inset-0 bg-black/50 flex items-center justify-center">
                    <span class="bg-red-500 text-white px-4 py-2 rounded-full font-semibold">
                      Agotado
                    </span>
                  </div>
                )}
              </div>
              <div class="p-6">
                <h3 class="font-display text-xl font-semibold text-earth-800 mb-3">
                  {product.name}
                </h3>
                <p class="text-earth-600 mb-4 text-sm leading-relaxed">
                  {product.description}
                </p>
                {/* Badges de beneficios */}
                <div class="flex flex-wrap gap-2 mb-4">
                  {Array.isArray(product.benefits) && product.benefits.map((benefit) => (
                    <span class="bg-sage-100 text-sage-700 px-3 py-1 rounded-full text-xs font-medium">
                      {benefit}
                    </span>
                  ))}
                </div>
                <div class="flex justify-between items-center mb-4">
                  <div class="flex flex-col">
                    <span class="font-bold text-2xl text-earth-800">
                      ${product.price.toLocaleString()}
                    </span>
                  </div>
                  <button 
                    class={`px-4 py-2 rounded-full font-medium transition-all duration-300 hover:scale-105 add-to-cart ${
                      product.inStock 
                        ? 'bg-sage-500 hover:bg-sage-600 text-white' 
                        : 'bg-gray-300 text-gray-500 cursor-not-allowed'
                    }`}
                    data-id={product.id}
                    data-name={product.name}
                    data-price={product.price}
                    data-image={product.images[0]}
                    disabled={!product.inStock}
                  >
                    {product.inStock ? 'Agregar' : 'Agotado'}
                  </button>
                </div>
                <a 
                  href={`/producto/${product.id}`}
                  class="block w-full text-center border-2 border-sage-500 text-sage-600 hover:bg-sage-500 hover:text-white px-4 py-2 rounded-full font-medium transition-all duration-300"
                >
                  Ver Detalles
                </a>
              </div>
            </div>
          ))}
        </div>
      </div>
    </section>

    <!-- Educational CTA -->
    <section class="py-16 bg-earth-800 text-cream-100">
      <div class="container mx-auto px-4">
        <div class="text-center max-w-4xl mx-auto">
          <h2 class="font-display text-3xl md:text-4xl font-bold mb-6">
            ¿Nuevo en el mundo de los hongos funcionales?
          </h2>
          <p class="text-xl mb-8 opacity-90">
            Descubre todo lo que necesitas saber sobre estos poderosos aliados naturales 
            en nuestra sección educativa completa.
          </p>
          <div class="flex flex-col sm:flex-row gap-4 justify-center">
            <a 
              href="/educacion"
              class="bg-sage-500 hover:bg-sage-600 text-white px-8 py-3 rounded-full font-semibold transition-all duration-300 hover:scale-105"
            >
              Guías de Consumo
            </a>
            <a 
              href="/nosotros"
              class="border-2 border-cream-100 text-cream-100 hover:bg-cream-100 hover:text-earth-800 px-8 py-3 rounded-full font-semibold transition-all duration-300 hover:scale-105"
            >
              Conoce Nuestra Historia
            </a>
          </div>
        </div>
      </div>
    </section>
  </main>

  <Footer />
  <Cart />

  <script>
    // Filter functionality
    document.addEventListener('DOMContentLoaded', function() {
      const filterButtons = document.querySelectorAll('.filter-btn');
      const productCards = document.querySelectorAll('.product-card');

      // Filter products
      filterButtons.forEach(button => {
        button.addEventListener('click', () => {
          const filter = button.dataset.filter;
          
          // Update active button
          filterButtons.forEach(btn => {
            btn.classList.remove('active', 'bg-sage-500', 'text-white');
            btn.classList.add('bg-sage-100', 'text-sage-700');
          });
          button.classList.add('active', 'bg-sage-500', 'text-white');
          button.classList.remove('bg-sage-100', 'text-sage-700');

          // Filter products
          productCards.forEach(card => {
            const category = card.dataset.category;
            if (filter === 'all' || category === filter) {
              card.style.display = 'block';
              card.classList.add('animate-fade-in');
            } else {
              card.style.display = 'none';
            }
          });
        });
      });

      // Search functionality
      const searchBar = document.getElementById('search-bar');

      searchBar.addEventListener('input', function() {
        const query = this.value.toLowerCase();
        productCards.forEach(card => {
          const name = card.dataset.name;
          const category = card.dataset.category;
          const benefits = card.dataset.benefits;
          if (
            name.includes(query) ||
            category.includes(query) ||
            benefits.includes(query)
          ) {
            card.style.display = 'block';
          } else {
            card.style.display = 'none';
          }
        });
      });

      // Cart functionality
      let cart = JSON.parse(localStorage.getItem('cart')) || [];

      function updateCartCount() {
        const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
        const cartCountElements = document.querySelectorAll('#cart-count, #mobile-cart-count');
        cartCountElements.forEach(el => {
          if (el) el.textContent = totalItems.toString();
        });
        
        // Dispatch custom event
        window.dispatchEvent(new CustomEvent('cartUpdated'));
      }

      function addToCart(id, name, price, image) {
        const existingItem = cart.find(item => item.id === id);
        
        if (existingItem) {
          existingItem.quantity += 1;
        } else {
          cart.push({
            id: id,
            name: name,
            price: price,
            image: image,
            quantity: 1
          });
        }
        
        localStorage.setItem('cart', JSON.stringify(cart));
        updateCartCount();
      }

      // Add to cart buttons
      document.querySelectorAll('.add-to-cart').forEach(button => {
        button.addEventListener('click', function() {
          if (this.disabled) return;
          
          const productId = this.dataset.id;
          const productName = this.dataset.name;
          const productPrice = parseInt(this.dataset.price);
          const productImage = this.dataset.image;
          
          addToCart(productId, productName, productPrice, productImage);
          
          // Visual feedback
          this.textContent = '¡Agregado!';
          this.classList.add('bg-green-500');
          setTimeout(() => {
            this.textContent = 'Agregar';
            this.classList.remove('bg-green-500');
          }, 1000);
        });
      });

      updateCartCount();
    });
  </script>
</Layout>